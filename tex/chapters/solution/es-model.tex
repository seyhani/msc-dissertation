\section{مدل علّی برای ساختمان رویداد}
\label{es-causal-model}
در ادامه نحوه‌ی توصیف یک ساختمان رویداد در قالب یک مدل علّی مطابق تعریف 
HP
را بیان می کنیم.
فرض کنیم که
$\mr{E} = (E,\#,\vdash)$
یک ساختمان رویداد باشد.
مدل علّی این ساختمان رویداد را به صورت
$\mc{M} = (\mc{S},\mc{F},\mc{E})$
تعریف می‌کنیم که در آن
$\mc{S} = (\mc{U},\mc{V},\mc{R})$.
در این مدل فرض می‌کنیم همه‌ی متغیر‌ها از نوع بولی هستند.
همچنین در این مدل متغیر برونی در نظر نمی‌گیریم بنابراین داریم
$\mc{U} = \e$.
اگر فرض کنیم مجموعه‌ رویدادها به صورت
$E = \s{e_1,e_2,...,e_n}$
باشد مجموعه‌ی متغیر‌های درونی را به صورت زیر تعریف می‌کنیم:
\begin{align*}
    \mathcal{V} = & \s{C_{e_i,e_j} ~|~  1 \leq i < j \leq n.
    e_i \in E \wedge e_j \in E}                              \\
                  & \cup \s{EN_{s,e} ~|~ s \in \mathcal{P}(E),
    e \in E. e \not \in s }                                  \\
                  & \cup \s{M_{s,e} ~|~ s \in \mathcal{P}(E),
        e \in E. e \not \in s } \cup \s{PV}
\end{align*}
به صورت شهودی به ازای هر عضو از رابطه‌های
$\#,\vdash,\vdash_{min}$
یک متغیر درونی در نظر می‌گیریم که درست بودن این متغیر به معنای وجود عنصر متناظر با آن در رابطه است.

به ازای
$x,y \in \mc{P}(E)$
پوشیده
شدن%
\lf{Covering}
$x$
توسط
$y$
را که با
$x \prec y$
نمایش می‌دهیم به صورت زیر تعریف می‌کنیم:
\begin{align*}
    x \subseteq y \wedge x \neq y \wedge
    (\forall z. x \subseteq z \subseteq y \Rightarrow x = z
    \text{ or } y = z)
\end{align*}
همچنین به ازای هر متغیر
$X \in \mc{V}$
بردار
$\vec V_X$
را بردار شامل همه‌ی متغیر‌های درونی به غیر از
$X$
تعریف می‌کنیم.
با استفاده از این تعاریف
توابع متغیر‌های درونی را به صورت زیر تعریف می‌کنیم:
$$
    \f{C_{e,e'}} = \begin{cases}
        true  & \text{ if } e \# e' \\
        false & \text{ otherwise }
    \end{cases}
$$
$$
    \f{M_{s,e}} = \begin{cases}
        Min(s,e) \wedge Con(s) & \text{ if } s \vdash_{min} e \\
        false                  & \text{ otherwise }
    \end{cases}
$$
\begin{align*}
    \f{EN_{s,e}} & =
    \left(
    M_{s,e} \vee
    \left(
    \bigvee_{s'\prec s}EN_{s',e}
    \right)
    \right)
    \bigwedge
    Con(s)
\end{align*}
که در آن‌ها داریم:
\begin{align*}
    Con(s)   & =   \left(
    \bigwedge_{ 1\leq j<j' \leq n \wedge e_j,e_{j'} \in s}
    \neg C_{e_j,e_{j'}}
    \right)               \\
    Min(s,e) & = \left(
    \bigwedge_{s' \subseteq E. (s' \subset s \vee s \subset s')
        \wedge e \notin s'}
    \neg M_{s',e}
    \right)
\end{align*}
فرض کنید که
$\mathbb{E}$
مجموعه‌ی تمامی سه‌تایی‌ها به فرم
$(E,\#',\vdash')$
باشد که داشته باشیم:
\begin{align*}
    \#' \subseteq E \times E \\
    \vdash' \subseteq \mc{P}(E)\times E
\end{align*}
یک تابع به فرم
$ES: \times_{V \in \mathcal{V}\setminus \s{PV}} \mathcal{R}(V) \rightarrow \mathbb{E}$
تعریف می‌کنیم که به صورت شهودی ساختمان رویداد حاصل از مقدار فعلی متغیر‌ها در مدل علّی را به دست می‌دهد.
فرض کنیم
$\vec v$
برداری شامل مقادیر متغیرهای
$\mc{V} \setminus \s{PV}$
باشد.
به ازای هر متغیر مانند
$V \in \mc{V}$
مقدار آن در
$\vec v$
را با
$\vec v(V)$
نمایش می‌دهیم.
تابع
$ES$
را به گونه‌ای تعریف می‌کنیم که اگر
$ES(\vec v) = (E,\#',\vdash')$
آنگاه داشته باشیم:
\begin{align*}
    \forall e,e' \in E. e \#' e' \wedge e' \#' e
     & \iff \vec{v}(C_{e,e'}) = \T \\
    \forall s \in \mathcal{P}(E), e \in E.  s \vdash' e
     & \iff \vec{v}(EN_{s,e}) = \T
\end{align*}
در ادامه فرض می‌کنیم که رفتار نا‌ امن%
\lf{Unsafe Behavior}
سیستمی که در قالب ساختمان رویداد مدل شده است، در قالب تابع متغیر
$PV$
توصیف شده است و در صورتی که رفتار نا ‌امن در سیستم وجود داشته باشد مقدار آن درست و در غیر این صورت غلط است.
در نهایت مقداردهی‌های مجاز
$\mc{E}$
را مجموعه‌ی مقداردهی‌هایی مانند
$\vec v$
در نظر می‌گیریم که خروجی تابع
$ES$
به ازای آن‌ها یک ساختمان رویداد باشد.

برای پیدا کردن علت واقعی در این مدل از تعریف زیر که در واقع سازگار شده‌ی تعریف
\ref{def:cause}
برای مدل‌ علّی تعمیم یافته است، استفاده می‌کنیم:

\begin{definition}
    \label{def:extended}
    اگر
    $M = (\mc{S},\mc{F},\mc{E})$
    یک مدل علّی تعمیم یافته و
    $\vec V$
    برداری از متغیر‌های
    $\mathcal{V} \setminus PV$
    باشد،
    فرمول
    $\vec X = \vec x$
    علت واقعی
    $\varphi$
    در
    $(M,\vec{u})$
    است
    اگر شرایط زیر برای آن برقرار باشد:
    \begin{enumerate}
        \item $(M,\vec{u}) \vDash (\vec{X} = \vec{x}) \wedge \varphi$
        \item یک افراز مانند
              $(\vec{Z},\vec{W})$
              از مجموعه‌ی متغیر‌های
              $\mc{V}$
              با شرط
              $\vec{X} \subseteq \vec{Z}$
              و مقادیر
              $(\vec{x},\vec{w}')$
              برای متغیر‌های
              $(\vec{X},\vec{W})$
              وجود داشته باشد که داشته باشیم
              $(M,\vec{u})\vDash \vec{Z} = \vec{z}^*$
              و شرایط زیر را برآورده کند:
              \begin{enumerate}
                  \item $(M,\vec u)\vDash
                  [\vec{X}\la\vec{x}',\vec{W}\la\vec{w}'] 
                  \neg \varphi \wedge \vec V = \vec v 
                  \wedge \vec v \in \mc E$
                  \item $\forall \vec{W'} \subseteq \vec{W},\vec{Z'}\in \vec{Z}.
                            (M,\vec{u})\vDash [\vec X\la\vec x,\vec{W}'\la \vec{w}',\vec{Z}'\la \vec{z}^*]
                            \vec V = \vec v \wedge \vec v \in \mc{E}
                            \Rightarrow \varphi$
              \end{enumerate}
        \item $\vec X$
              مینیمال باشد.
    \end{enumerate}
\end{definition}
در این تعریف برای اینکه تنها مقداردهی‌های مجاز برای پیدا کردن علت واقعی در نظر گرفته شوند شرط ۲ تغییر یافته است.
بند اضافه شده به شرط ۲.آ بیان می‌کند که تغییرات ایجاد شده در مدل یک مقدار دهی مجاز باشند.
بند اضافه شده در ۲.ب باعث می‌شود این شرط تنها در حالت‌هایی بررسی شود که مقداردهی داده شده مجاز باشد.
